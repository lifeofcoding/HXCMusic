 var App=new Backbone.Marionette.Application();_.extend(App,{Regions:{},Controller:{},View:{},Model:{},Page:{},Player:{},Modal:{},Models:{},isReady:false,baseURL:'http://'+document.location.host,apiURL:'http://api.'+document.location.host.replace('development.',''),socket:null,usersOnline:0,songsStreaming:[],currentView:null,isGoogle:false,favicon:new Favico({animation:'popFade'})});App.addRegions({viewport:'#wrapper'});App.addInitializer(function(options){var mainWindow=new App.View.Viewport();try{App.viewport.show(mainWindow);}catch(e){console.error('Couldn\'t start app: ',e,e.stack);}
Marionette.Region.prototype.attachHtml=function(view){if(this.$el.attr('id')!=='homepage'){this.$el.hide();this.$el.html(view.el);var content=this.$el;content.animo({animation:"magictime fadeInUp",keep:false,duration:0.5},function(){}).show();}else{this.$el.hide();this.$el.html(view.el).show();}};});(function(App){'use strict';App.module("Playlist",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}
App.vent.on('initialize:player',_.bind(this.initializePlayer,this));},addToFavorites:function(e){if(App.User.isLoggedIn){var songId=$(e.target).data('song-id'),songRecord=App.Model.Music.findWhere({id:songId});var checkFavs=App.Model.Favorites.findWhere({songId:songId});if(typeof checkFavs!=='undefined'){App.vent.trigger('message','Error','Already added to favorites!');return;}
var favModel=new App.Model.Favorite();favModel.set({bitrate:songRecord.get('bitrate'),songId:songRecord.get('id'),playtime:songRecord.get('playtime'),name:songRecord.get('name'),userId:App.User.userId});App.Model.Favorites.add(favModel);favModel.save().done(function(){$(e.target).addClass('on');App.vent.trigger('message','Added To Favorites',App.Util.capitalizeWords(songRecord.get('name')));});}else{App.vent.trigger('message','Error','You must be logged in to add to favorites.');}},addToQueue:function(e){var model;if(App.currentPage==='showFavorites'){model=App.Model.Favorites;}else{model=App.Model.Music;}
var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});App.Model.Queue.add(songRecord);App.vent.trigger('message','Added To Queue',App.Util.capitalizeWords(songRecord.get('name')));},removeFromFavorites:function(e){var model=App.Model.Favorites;var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});$('.tooltip').poshytip('hide');songRecord.destroy({url:App.apiURL+'/favorites/'+songRecord.id,success:function(model,response){App.vent.trigger('message','Removed From Favorites',App.Util.capitalizeWords(songRecord.get('name')));}});},removeFromQueue:function(){var model=App.Model.Queue;var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});App.Model.Queue.remove(songRecord);App.vent.trigger('message','Removed From Queue',App.Util.capitalizeWords(songRecord.get('name')));},showDownloadDialog:function(e){App.Dialog.Download.apply(this,arguments);},streamSong:function(e){e.preventDefault();if(typeof App.Player.currentSongId!=='undefined'&&App.Player.currentSongId!==null){App.vent.trigger('localStreamEnded',App.Player.currentSongId);}
App.Player.isRadio=false;var songId=$(e.target).data('song-id'),playtime=$(e.target).data('playtime'),songTitle=$(e.target).data('song-title');App.vent.trigger('message','Now Playing',songTitle,{position:'left'});$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.MusicController.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="'+App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png" width="40" height="40" class="display_coverart_glare">').show();App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();$('#player-download-button').show();$('#player-download-button div, #player-download-button').data('song-id',songId);$('#player-download-button div, #player-download-button').data('song-title',songTitle);$('#player-download-button div, #player-download-button').data('playtime',playtime);},initializePlayer:function(){var me=this,currentProps=App.Player;App.Player=$('#audio-element').mediaelementplayer({startVolume:App.Volume.volume,success:function(mediaElement,domObject){mediaElement.addEventListener('volumechange',function(e){},false);mediaElement.addEventListener('canplay',function(e){App.socket.emit('streamStarted',{songTitle:App.Player.currentSongTitle,songId:App.Player.currentSongId});$('#current_playlist_rows').find('a[data-song-title="'+App.Player.currentSongTitle+'"]').parents('li').addClass('.playing');},false);mediaElement.addEventListener('play',function(e){App.Player.isPlaying=true;App.Player.isPaused=false;$('#play_button').addClass('paused');},false);mediaElement.addEventListener('ended',function(e){$('#current_playlist_rows').find('.playing').removeClass('.playing');App.Player.isPlaying=false;App.vent.trigger('localStreamEnded',App.Player.currentSongId);if(!App.Player.isRadio){if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex,plus;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex+1);}else{plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):0;}
if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('id'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.MusicController.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="'+App.baseURL+'/api/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png" width="40" height="40" class="display_coverart_glare">').show();App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();}}else{App.Player.Radio();}},false);mediaElement.addEventListener('pause',function(e){App.Player.isPlaying=false;App.Player.isPaused=true;$('#play_button').removeClass('paused');},false);mediaElement.addEventListener('error',function(){$.ajax({type:"GET",url:App.baseURL+'/api/getyoutubeurl.php?id='+App.Player.currentSongId,success:function(url){me.streamYoutubeSong(url);}});},false);}});App.Player=App.Player.get(0);App.Player.Radio=currentProps.Radio;},streamYoutubeSong:function(url){var me=this,currentProps=App.Player;url='https://www.youtube.com/watch?v='+url;var videoElement=''+'<video autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'">'+'<source type="video/youtube" src="'+url+'" />'+'</video>';$('#audio-span').html(videoElement);App.Player=$('#audio-element').mediaelementplayer({startVolume:App.Volume.volume,alwaysShowControls:true,videoVolume:'horizontal',features:['playpause','progress','volume'],success:function(mediaElement,domObject){$('.mejs-layers').css('display','none');$('.me-plugin').css('visibility','hidden');$('.mejs-controls').css({top:'0px','margin-left':'25px'});mediaElement.addEventListener('volumechange',function(e){},false);mediaElement.addEventListener('canplay',function(e){App.socket.emit('streamStarted',{songTitle:App.Player.currentSongTitle,songId:App.Player.currentSongId});$('#current_playlist_rows').find('a[data-song-title="'+App.Player.currentSongTitle+'"]').parents('li').addClass('.playing');},false);mediaElement.addEventListener('ended',function(e){$('#current_playlist_rows').find('.playing').removeClass('.playing');App.Player.isPlaying=false;App.vent.trigger('localStreamEnded',App.Player.currentSongId);if(!App.Player.isRadio){if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex,plus;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex+1);}else{plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):0;}
if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('id'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.MusicController.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="'+App.baseURL+'/api/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png" width="40" height="40" class="display_coverart_glare">').show();App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();}}else{App.Player.Radio();}},false);mediaElement.addEventListener('play',function(e){App.Player.isPlaying=true;App.Player.isPaused=false;$('#play_button').addClass('paused');},false);mediaElement.addEventListener('pause',function(e){App.Player.isPlaying=false;App.Player.isPaused=true;$('#play_button').removeClass('paused');},false);}});App.Player=App.Player.get(0);App.Player.Radio=currentProps.Radio;}});})(window.App);(function(App){'use strict';App.module("Ads",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}},viewport:function(){return App.viewport.currentView.ui;},bottom:function(){this.viewport().bottomAdWrapper.html('<div id="bottom_ad">'+this.options.displayAd('bottom')+'</div>');},displayAd:function(position){$.getScript('//cdn.chitika.net/getads.js');if(window.CHITIKA===undefined){window.CHITIKA={'units':[]};}
var unit={"calltype":"async[2]","publisher":"ccastillo","width":550,"height":250,"sid":"Index HXC","color_site_link":"ffffff","color_button":"1b79b8","color_button_text":"ffffff"};var placement_id=window.CHITIKA.units.length;window.CHITIKA.units.push(unit);return'<div id="chitikaAdBlock-'+placement_id+'"></div>';}});})(window.App);(function(App){'use strict';App.module("Settings",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){if(key==='baseURL'){App[key]=options[key]();}else{App[key]=options[key];}
if(key==='baseURL'){this[key]=options[key]();}else{this[key]=options[key];}}}
this.setupEnvironment();},startTimeoutTimer:function(){var idleTime=0,timerIncrement=function(){idleTime=idleTime+1;if(idleTime>10){App.vent.trigger('lockscreen','show');}};var idleInterval=setInterval(timerIncrement,60000);$(this).mousemove(function(e){idleTime=0;});$(this).keypress(function(e){idleTime=0;});},setupEnvironment:function(){if(typeof window.environment==='undefined'){var url=document.location.href;App.isProduction=!(url.indexOf('playground')>-1||url.indexOf('development')>-1||url.indexOf('?debug=1')>-1);App.isDevelopment=(url.indexOf('playground')>-1||url.indexOf('development')>-1||url.indexOf('?debug=1')>-1);App.Environment=App.isProduction?'production':'development';}else{App.Environment=window.environment;App.isProduction=App.Environment==='production'?true:false;App.isDevelopment=App.Environment==='development'?true:false;}
if(App.isProduction){}},apiURL:'http://api.hxcmusic.com',downloadServer:window.downloadServer,stripTrailingSlash:function(str){if(str.substr(-1)==='/'){return str.substr(0,str.length-1);}
return str;},websiteTitle:document.location.host==='hxcmusic.com'?'HXCMusic.com':'HXCMusic.me',webRoot:'/',baseURL:function(){return this.getBaseURL(document.location.href)+this.webRoot.substring(1);},getBaseURL:function(url){var base=url.match(/^http[s]?:\/\/([a-zA-Z0-9-]*\.*)*[a-zA-Z0-9-]+(?!\.[a-zA-Z0-9-]{2,3})\/*/);if(base){return this.stripTrailingSlash(base[0]);}else{return"";}}});})(window.App);(function(App){'use strict';App.module("Search",{initialize:function(moduleName,app,options){App.vent.on('search',_.bind(options.fetchResults,options.getParams()));App.resultsType='music';var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}},_moveTimer:null,initializeAlbumsContainer:function(){var _this=this,scollWidth,canScroll,hovering=false,albumsWrapper=$('#albums-wrapper'),scrolled=0,css={},prefix=App.browserPrefix.css,albumsTable=$('#albums-wrapper table');if(albumsWrapper.width()<albumsTable.width()){scollWidth=albumsTable.width()-albumsWrapper.width();$('.scroll-indicator').hover(function(e){hovering=true;var moveContainer=function(direction,duration){if(direction==='left'){canScroll=scrolled<0;_this._moveTimer=setTimeout(function(){if(canScroll){scrolled=scrolled+albumsWrapper.width();css[prefix+'transform']='translate3d('+scrolled+'px, 0, 0)';albumsTable.css(css).afterTransition(function(){if(hovering){moveContainer(direction,2000);}});}},duration);}
if(direction==='right'){canScroll=scollWidth>=Math.abs(scrolled);_this._moveTimer=setTimeout(function(){if(canScroll){scrolled=scrolled-albumsWrapper.width();css[prefix+'transform']='translate3d('+scrolled+'px, 0, 0)';albumsTable.css(css).afterTransition(function(){if(hovering){moveContainer(direction,2000);}});}},duration);}};moveContainer($(this).data('direction'),100);},function(){clearTimeout(_this._moveTimer);hovering=false;});}else{$('.scroll-indicator').hide();}},_loadingNext:false,_maxPages:5,nextPage:function(){var _this=this,params=App.Search.options.getParams(),model,collection,url;if(!this._loadingNext&&this._maxPages>params.page){App.resultsPage=(App.resultsPage+1);_this._loadingNext=true;if(App.resultsType==='music'){collection=App.Model.Music;url=App.apiURL+'/search.php?search='+params.search+'&page='+App.resultsPage;}else{collection=App.Model.Videos;url=App.apiURL+'/search-videos.php?search='+params.search+'&page='+App.resultsPage;}
$.ajax({url:url,beforeSend:function(xhr){App.Regions.Content.$el.append('<span id="more-results"><center><img src="/loading-bars.svg"></center></span>');}}).done(function(data){if(typeof data==='string'){data=JSON.parse(data);}
$('#more-results').remove();var prevCount=collection.length;_.each(data,function(value,index){collection.add(value);});var nextPage=_.template($('#results-tpl').html())({count:prevCount});App.Regions.Content.$el.append(nextPage);_this._loadingNext=false;});}},showAlbums:function(artist){var me=this,searchParams=this.getParams();$.ajax({url:App.baseURL+'/api/albums.php?artist='+App.Util.seoFriendlyDashes(artist),beforeSend:function(xhr){}}).done(function(data){if(data){var albums=JSON.parse(data);if(albums.length>0){App.Util.waitTillReady('#albums',function(){$('#albums').html(_.template($('#albums-tpl').html())(albums));var initializeAlbumsContainer=_.bind(me.initializeAlbumsContainer,me);setTimeout(function(){initializeAlbumsContainer();},3000);});}}});},showBio:function(){var me=this,searchParams=this.getParams();$.ajax({url:App.baseURL+'/api/bio.php?artist='+App.Util.seoFriendlyDashes(searchParams.search),beforeSend:function(xhr){}}).done(function(data){if(data){var bio=JSON.parse(data);if(typeof bio[0]!=='undefined'){App.Util.waitTillReady('#bio',function(){$('#bio').html(_.template($('#bio-tpl').html())(bio[0]));me.showAlbums(bio[0].artist);var bioImage=$('.bio-image img');$('#bio').css('visibility','hidden');bioImage.one('load',function(){var showBioImage=function(){$('#bio').animo({animation:'fadeInUp',duration:0.4,keep:false},function(){}).css('visibility','visible');};showBioImage();}).each(function(){if(this.complete){$(this).load();}});});}}});},fetchResults:function(search){App.vent.trigger('loading:start',search);var model=App.resultsType==='music'?App.Model.Music:App.Model.Videos;model.fetch({update:true}).done(function(data){App.vent.trigger('search:results',App.resultsType);if(App.resultsType==='music'){App.Search.options.showBio();}});},getParams:function(){return{search:$('#top_search_input').val(),page:App.resultsPage=App.resultsPage?App.resultsPage:1,type:App.resultsType=App.resultsType?App.resultsType:'music',};},fetchBitrate:function(songId,playtime,callback){$.ajax({type:"GET",url:App.apiURL+"/bitrate.php?id="+songId+"&seconds="+playtime,}).done(function(data){if(data){data=JSON.parse(data);}
callback.call(this,data);});},fetchAlbumInfo:function(songTitle,callback){$.ajax({type:"GET",url:App.apiURL+"/albuminfo/"+App.Util.seoFriendlyDashes(songTitle)+"",}).done(function(data){if(data){data=JSON.parse(data);}
callback.call(this,data);});}});})(window.App);(function(App){'use strict';App.module("Logger",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}},startLogging:function(){window.onerror=function(message,url,linenumber,colno,error){var n=url.indexOf('.js');url=url.substring(0,n!==-1?(n+3):url.length);var parts=url.split('/'),result=parts[parts.length-2]+'/'+parts[parts.length-1],errorMessage=[];errorMessage.push(result+':'+linenumber);errorMessage.push(message);url=url.replace('http://'+document.location.host+'/','',url);_gaq.push(['_trackEvent',"Errors","Javascript Exceptions",url+"("+linenumber+"): "+message]);$.ajax({type:'POST',url:'/notifyOfErrors.php',data:{m:result+':'+linenumber+'\n'+message}});};$(document).ajaxError(function(event,jqXHR,ajaxSettings,thrownError){var statusText;if(jqXHR.status!==200&&!App.Util.contains(ajaxSettings.url,'notifyOfErrors')){statusText=jqXHR.statusText;var url=ajaxSettings.url,n=url.indexOf('.js');url=url.substring(0,n!==-1?(n+3):url.length);var parts=url.split('/'),result=parts[parts.length-2]+'/'+parts[parts.length-1],errorMessage=[];result=url.replace('http://'+document.location.host+'/','',result);errorMessage.push(result);errorMessage.push(thrownError);_gaq.push(['_trackEvent',"Errors","Ajax Error - ",result+": "+thrownError]);$.ajax({type:'POST',url:'/notifyOfErrors.php',data:{m:result+'\n'+thrownError}});App.vent.trigger('message','Error','Unable to complete request.<br>We have been notified of the problem.');}});}});})(window.App);(function(App){'use strict';App.module("googleAPI",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}
window.loginCallback=this.options.loginCallback;},logout:function(){gapi.auth.signOut();location.reload();},login:function(){var myParams={'clientid':'867875238550-ko6v5l9e89hlg00l14l4potp3qqb81g6.apps.googleusercontent.com','cookiepolicy':'single_host_origin','callback':'loginCallback','approvalprompt':'force','scope':'https://www.googleapis.com/auth/plus.login https://www.googleapis.com/auth/plus.profile.emails.read'};gapi.auth.signIn(myParams);},loginCallback:function(result){var imageURL,message;gapi.client.load('plus','v1',function(){if(result['status']['signed_in']){var request=gapi.client.plus.people.get({'userId':'me'});request.execute(function(resp){var email='';if(resp.emails){for(var i=0;i<resp.emails.length;i++){if(resp.emails[i].type==='account'){email=resp.emails[i].value;}}}
imageURL=App.Util.stripAfter(resp.image.url,'?sz=');$.ajax({type:"POST",url:App.apiURL+"/imageFromURL.php",data:{url:imageURL+'?sz=190',username:App.Util.stripAfter(email,'@')}}).done(function(image){$.ajax({type:"POST",url:App.apiURL+"/signup.php",data:{username:App.Util.stripAfter(email,'@'),image:image,email:email,isGoogle:true}}).done(function(data){data=JSON.parse(data);if(typeof data.error!=='undefined'){App.vent.trigger('message','Error','Username, Email or IP in use!<br>You may need to sign-up manually.');$('.messi:visible').animo({animation:"shake",keep:false,duration:0.8});}else{if(typeof App.Modal.Signup!=='undefined'&&App.Modal.Signup.visible){App.Dialog.hideModal(App.Modal.Signup);message='Signed Up Successfully!';}
if(typeof App.Modal.Login!=='undefined'&&App.Modal.Login.visible){App.Dialog.hideModal(App.Modal.Login);message='Welcome Back!';}
_gaq.push(['_trackEvent',"User Events","Registrations",data.email]);App.Model.User.set({id:Number(data.id),dailyDownloads:Number(data.dailyDownloads),downloadLimit:Number(data.userLevel)===5?null:3,email:data.email,ip:data.ip,isLoggedIn:true,totalDownloads:Number(data.totalDownloads),userId:data.userId,userLevel:Number(data.userLevel),username:data.username,image:data.image});App.vent.trigger('ui:loggedin');App.Router.navigate('upgrade',{trigger:true});App.vent.trigger('message','',message);}});});});}});},onLoadCallback:function(){gapi.client.setApiKey('AIzaSyBbb6asME6pzoBZ7t9ZSfrUlZaoKejF610');gapi.client.load('plus','v1',function(){});}});})(window.App);(function(App){'use strict';App.module("Dialog",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}},showModal:function(modal){modal.show();},hideModal:function(modal){modal.messi.animo({animation:"vanishOut",keep:false,duration:0.45},function(){modal.hide();});},DownloadAlbum:function(e){e.preventDefault();var me=this,artist=$(e.target).data('artist'),album=$(e.target).data('album'),image=$(e.target).attr('src');if(App.User.isLoggedIn&&App.User.userLevel>1){App.Modal.AlbumDownload=new Messi(_.template($('#albumdownload-tpl').html())({artist:artist,album:album,image:image}),{modal:true,modalOpacity:0.3,show:false,title:album,titleClass:'anim',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Download',val:'download',class:'download-modal-button'}]});App.Dialog.showModal(App.Modal.AlbumDownload);App.Modal.AlbumDownload.messi.find('.btnbox').unbind('click');App.Modal.AlbumDownload.resize();$.ajax({url:App.baseURL+'/api/albumTracks.php?album='+album+'&artist='+artist}).done(function(data){data=JSON.parse(data);var tracks='';for(var i=0,len=data.length;i<len;++i){tracks+=(i+1)+'. '+data[i].title+'<br>';}
$('.tracks').html(tracks);});App.Util.waitTillReady('.download-modal-button',function(){$('.download-modal-button').one('click',function(){var modalHeight=$('.albumdownload-wrapper').outerHeight();$('.albumdownload-wrapper').css('height',modalHeight+'px').html('<br><br><center><img src="'+App.baseURL+'/images/loader-white.gif"></center>');var dir,files;$('.messi-actions').hide();$(this).parents('.btnbox').remove();$('.cancel-button').text('Close');$.ajax({url:App.baseURL+'/api/downloadAlbum.php?artist='+artist+'&album='+album}).done(function(data){data=JSON.parse(data);dir=data.dir;files=data.files;var checkProgress=function(){setTimeout(function(){$.ajax({method:'GET',url:App.baseURL+'/api/albumDownloadProgress.php',data:{dir:dir,files:files,artist:artist,album:album}}).done(function(data){data=JSON.parse(data);if(data.status==='downloading'){checkProgress();}
if(data.status==='finished'){$('.messi-actions').show();$('.albumdownload-wrapper').html('<center><img src="'+App.baseURL+'/images/notification_done.png"><br><br><a href="'+App.apiURL+'/'+data.url+'" data-bypass="true">Download Album Archive</a></center>');}});},3000);};checkProgress();});});$('.cancel-button').one('click',function(e){$('.download-modal-button').unbind('click');App.Dialog.hideModal(App.Modal.AlbumDownload);});});}else if(!App.User.isLoggedIn){App.Dialog.SignUp('Please Sign-Up To Download');}else if(App.User.isLoggedIn&&App.User.userLevel<5){App.Dialog.Upgrade('userlevel');}},SignUp:function(error){if(!error){error='Sign-Up';}
var me=this;App.Modal.Signup=new Messi(_.template($('#signup-tpl').html()),{modal:true,modalOpacity:0.3,show:false,title:error,titleClass:'anim',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Sign-Up',val:'signup',class:'signup-button'}]});App.Dialog.showModal(App.Modal.Signup);setTimeout(function(){Recaptcha.create("6LdPXPUSAAAAAGS_OydiIAIrLccVlqPavbIqf5N0",$('#recaptcha_div').get(0),{theme:"clean",callback:function(){App.Modal.Signup.resize();Recaptcha.focus_response_field();}});},1000);App.Modal.Signup.messi.find('.btnbox').unbind('click');$(document).on('click','.googlesignin',function(e){e.preventDefault();App.googleAPI.login();});$(document).on('click','.signup-button',function(e){App.vent.trigger('message','Please Wait','Creating your account...');$.ajax({type:"POST",url:App.apiURL+"/signup.php",data:{username:$('input[name="username"]').val(),email:$('input[name="email"]').val(),image:null,password:$('input[name="password"]').val(),recaptcha_challenge_field:$('[name="recaptcha_challenge_field"]').val(),recaptcha_response_field:$('[name="recaptcha_response_field"]').val()}}).done(function(data){data=JSON.parse(data);if(typeof data.error!=='undefined'){App.vent.trigger('message','Error',data.error.text);Recaptcha.create("6LdPXPUSAAAAAGS_OydiIAIrLccVlqPavbIqf5N0",$('#recaptcha_div').get(0),{theme:"clean",callback:function(){Recaptcha.focus_response_field();}});$('.messi:visible').animo({animation:"shake",keep:false,duration:0.8});}else{App.Dialog.hideModal(App.Modal.Signup);_gaq.push(['_trackEvent',"User Events","Registrations",data.email]);App.Model.User.set({id:Number(data.id),dailyDownloads:Number(data.dailyDownloads),downloadLimit:Number(data.userLevel)===5?null:3,email:data.email,ip:data.ip,isLoggedIn:true,totalDownloads:Number(data.totalDownloads),userId:data.userId,userLevel:Number(data.userLevel),username:data.username,image:data.image});App.vent.trigger('ui:loggedin');App.Router.navigate('upgrade',{trigger:true});App.vent.trigger('message','','Signed Up Successfully!');}});});$(document).on('click','.cancel-button',function(e){App.Dialog.hideModal(App.Modal.Signup);$(document).off('click','.signup-button');});},VideoDownload:function(e){var me=this,reachedLimit=App.User.userLevel>1?false:(Number(App.User.downloadLimit)<=Number(App.User.dailyDownloads));if(App.User.isLoggedIn&&!reachedLimit){var videoId=$(e.target).parents('a').data('video-id'),videoTitle=$(e.target).parents('a').data('video-title'),videoImage=$(e.target).parents('a').data('video-image'),videoDesc=$(e.target).parents('a').data('video-desc'),downloadUrl='http://'+document.location.host+'/converter/index.php?url=http://www.youtube.com/watch?v='+videoId+'&type=video';App.Modal.VideoDownload=new Messi(_.template($('#videodownload-tpl').html())({videoId:videoId,videoTitle:videoTitle,videoImage:videoImage,videoDesc:videoDesc}),{modal:true,modalOpacity:0.3,show:false,title:videoTitle,titleClass:'anim',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Download',val:'download',class:'download-modal-button'}]});App.Dialog.showModal(App.Modal.VideoDownload);App.Modal.VideoDownload.messi.find('.btnbox').unbind('click');App.Modal.VideoDownload.resize();App.Util.waitTillReady('.download-modal-button',function(){$('.download-modal-button').one('click',function(){$(this).remove();$('.cancel-button').text('Close');$('.videodownload-wrapper').html('<iframe src="'+downloadUrl+'"></iframe>');$('.videodownload-wrapper iframe').on('load',function(){var contentHeight=$(this).get(0).contentWindow.document.body.scrollHeight,contentWidth=$(this).get(0).contentWindow.document.body.scrollWidth;$('.videodownload-wrapper, .videodownload-wrapper iframe').animate({height:contentHeight},500,function(){App.Modal.VideoDownload.resize();});});var daily=Number(App.Model.User.get('dailyDownloads'))+1,total=Number(App.Model.User.get('totalDownloads'))+1;App.Model.User.save({'dailyDownloads':daily,'totalDownloads':total,'lastDownloaded':moment().unix(),'ip':App.clientIP});if(App.User.userLevel<5){setTimeout(function(){App.vent.trigger('show:downloadsLeft');},3000);}});$('.cancel-button').one('click',function(e){$('.download-modal-button').unbind('click');App.Dialog.hideModal(App.Modal.VideoDownload);});});}else if(!App.User.isLoggedIn){App.Dialog.SignUp('Please Sign-Up To Download');}else if(App.User.isLoggedIn&&reachedLimit){App.Dialog.Upgrade();}},Upgrade:function(type){var me=this,isLimit=typeof type==='undefined'?true:false;App.Modal.Upgrade=new Messi(_.template($('#upgradeprompt-tpl').html())(isLimit),{modal:true,modalOpacity:0.3,show:false,titleClass:'anim',title:isLimit?'Download Limit Reached':'Premium Feature',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Upgrade',val:'upgrade',class:'upgrade-modal-button'}]});App.Dialog.showModal(App.Modal.Upgrade);App.Util.waitTillReady('.upgrade-modal-button',function(){App.Modal.Upgrade.messi.find('.btnbox').unbind('click');$('.cancel-button').one('click',function(e){$('.download-modal-button').unbind('click');App.Dialog.hideModal(App.Modal.Upgrade);});$('.upgrade-modal-button').one('click',function(e){$('.upgrade-modal-button').unbind('click');App.Dialog.hideModal(App.Modal.Upgrade);App.Router.navigate('upgrade',{trigger:true});});});},Download:function(e){if(e){e.preventDefault();}
var me=this,reachedLimit=App.User.userLevel>1?false:(Number(App.User.downloadLimit)<=Number(App.User.dailyDownloads));if(App.User.isLoggedIn&&!reachedLimit){var songId=$(e.target).parents('a').data('song-id'),songTitle=$(e.target).parents('a').data('song-title'),playtime=$(e.target).parents('a').data('playtime'),fetchType=App.Model.User.get('userLevel')===1?'fetchit':'fetch',downloadUrl='http://'+document.location.host+'/'+fetchType+'/'+songId+'.mp3';App.Modal.Download=new Messi(_.template($('#download-tpl').html()),{modal:true,modalOpacity:0.3,show:false,title:songTitle,titleClass:'anim',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Download',val:'download',class:'download-modal-button'}]});App.Search.fetchAlbumInfo(songTitle,function(data){App.Dialog.showModal(App.Modal.Download);App.Modal.Download.messi.find('.btnbox').unbind('click');$('.download-wrapper').html(_.template($('#albuminfo-tpl').html())(data[0]));App.Modal.Download.resize();});App.Search.fetchBitrate(songId,playtime,function(data){if(!data.error&&data){App.Modal.Download.messi.find('.playtime').html(data.kbps+' Kbps - '+data.size+'MB');}else{App.Modal.Download.messi.find('.playtime').html('Unknown');}});App.Util.waitTillReady('.download-modal-button',function(){$('.messi-content:visible').css('height',$('.messi-content:visible').height());$('.download-modal-button').one('click',function(){$('.download-modal-button').parents('.btnbox').css({'opacity':0.7,'pointer-events':'none'});var launchDownload=function(){var downloadIcon='<span class="jGrowl-download-icon icon-uniE600"></span>';App.vent.trigger('message','',downloadIcon+' Download will start in a moment...',{timeout:5000});var daily=Number(App.Model.User.get('dailyDownloads'))+1,total=Number(App.Model.User.get('totalDownloads'))+1;App.Model.User.save({'dailyDownloads':daily,'totalDownloads':total,'lastDownloaded':moment().unix(),'ip':App.clientIP}).done(function(data){document.location.href=downloadUrl;if(App.User.userLevel<5){setTimeout(function(){App.vent.trigger('show:downloadsLeft');},3000);}});App.Dialog.hideModal(App.Modal.Download);};if(App.User.userLevel<5){var wait=30;$('.download-wrapper').html(_.template($('#countdown-tpl').html()));var countDown=function(){App.Modal.Download.countDown=setTimeout(function(){--wait;$('.countdown-wrapper').find('.count-down').html(wait);if(wait===0){launchDownload();}else{countDown();}},1000);};countDown();$('.messi-content:visible').animate({height:$('.download-wrapper').height()},500,function(){});}else{launchDownload();}});$('.cancel-button').one('click',function(e){$('.download-modal-button').unbind('click');App.Dialog.hideModal(App.Modal.Download);if(App.Modal.Download.countDown){clearTimeout(App.Modal.Download.countDown);}});});}else if(!App.User.isLoggedIn){App.Dialog.SignUp('Please Sign-Up To Download');}else if(App.User.isLoggedIn&&reachedLimit){App.Dialog.Upgrade();}},Login:function(e){if(e){e.preventDefault();}
if(typeof App.Modal.Login!=='undefined'){App.Modal.Login.show();App.Modal.Login.messi.addClass('messi-open');return;}
var me=this;App.Modal.Login=new Messi(_.template($('#login-tpl').html()),{modal:true,modalOpacity:0.3,show:false,title:'Member Login',titleClass:'anim',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Login',val:'login',class:'login-button'}]});App.Dialog.showModal(App.Modal.Login);App.Modal.Login.messi.find('.btnbox').unbind('click');$(document).on('click','.googlesignin',function(e){e.preventDefault();App.googleAPI.login();});$(document).on('click','.login-button',function(e){var isEmail=$('input[name="email"]').val().indexOf('@')>-1,params={},loginAttr=isEmail?'email':'username';params[loginAttr]=$('input[name="email"]').val();params.password=$('input[name="password"]').val();$.ajax({type:"POST",url:App.apiURL+"/login.php",data:params}).done(function(data){data=JSON.parse(data);App.Modal.Login.hide();if(typeof data.userId!=='undefined'){_gaq.push(['_trackEvent',"User Events","Logins",data.email]);App.Model.User.set({id:Number(data.id),dailyDownloads:Number(data.dailyDownloads),downloadLimit:Number(data.userLevel)===5?null:3,email:data.email,ip:data.ip,isLoggedIn:true,totalDownloads:Number(data.totalDownloads),userId:data.userId,userLevel:Number(data.userLevel),username:data.username,image:data.image,isGoogle:data.isGoogle?data.isGoogle:false});App.vent.trigger('ui:loggedin');App.vent.trigger('message','','Welcome Back!');}else{App.vent.trigger('message','Error','Login Details Incorrect');}});});$(document).on('click','.cancel-button',function(e){App.Dialog.hideModal(App.Modal.Login);});}});})(window.App);(function(App){'use strict';App.module("Utilities",{initialize:function(moduleName,app,options){App.Util=options;App.Util.encode=options.Base64.encode;App.Util.decode=options.Base64.decode;App.browserPrefix=options.browserPrefix();window.debugHXC=function(){document.location.href='?debug=1';};},getURLParameter:function(name){return decodeURIComponent((new RegExp('[?|&]'+name+'='+'([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g,'%20'))||null;},calculateAspectRatioFit:function(srcWidth,srcHeight,maxWidth,maxHeight){var ratio=Math.min(maxWidth / srcWidth,maxHeight / srcHeight);return{width:srcWidth*ratio,height:srcHeight*ratio};},browserPrefix:function(){var styles=window.getComputedStyle(document.documentElement,''),pre=(Array.prototype.slice.call(styles).join('').match(/-(moz|webkit|ms)-/)||(styles.OLink===''&&['','o']))[1],dom=('WebKit|Moz|MS|O').match(new RegExp('('+pre+')','i'))[1];return{dom:dom,lowercase:pre,css:'-'+pre+'-',js:pre[0].toUpperCase()+pre.substr(1)};},waitForModel:function(model,callback){var checkReady=function(){setTimeout(function(){if(typeof App.Model[model]!=='function'){callback();}else{checkReady();}},500);};checkReady();},capitalizeWords:function(str){var me=this;return str.replace(/\w\S*/g,function(txt){return me.removeDashes(txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase());});},waitTillReady:function(element,callback){var wait=$.Deferred();var checkSelector=setInterval(function(){if($(element).length){wait.resolve();clearInterval(checkSelector);}},100);wait.done(function(){callback.call($(element));});},contains:function(string,key){return string.indexOf(key)>-1;},getRandomInt:function(min,max){return Math.floor(Math.random()*(max-min+1))+min;},waitTillDefined:function(variable,callback){var wait=$.Deferred();var checkDefined=setInterval(function(){if(typeof window[variable]!=='undefined'){wait.resolve();clearInterval(checkDefined);}},100);wait.done(function(){callback();});},afterPageRender:function(callback){this.waitTillReady('#explore_content_sotd',function(){callback();});},seoFriendlyDashes:function(string){string=string.split('%20').join(' ').trim();string=string.replace(/[^a-zA-Z0-9 ]/g,"");string=string.split(' ').join('-');return string;},removeDashes:function(string){string=string.split('-').join(' ');return string.split('+').join(' ');},absolutePath:function(href){var link=document.createElement("a");link.href=href;return(link.protocol+"//"+link.host+link.pathname+link.search+link.hash);},fixMixedUni:function(x){var r=/\\u([\d\w]{4})/gi;x=x.replace(r,function(match,grp){return String.fromCharCode(parseInt(grp,16));});x=unescape(x);return x;},stripAfter:function(string,key){var n=string.indexOf(key);return string.substring(0,n!==-1?n:string.length);},getFilename:function(string){return string.replace(/^.*(\\|\/|\:)/,'');},Base64:{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=this.Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}
t=t+this.Base64._keyStr.charAt(s)+this.Base64._keyStr.charAt(o)+this.Base64._keyStr.charAt(u)+this.Base64._keyStr.charAt(a)}
return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this.Base64._keyStr.indexOf(e.charAt(f++));o=this.Base64._keyStr.indexOf(e.charAt(f++));u=this.Base64._keyStr.indexOf(e.charAt(f++));a=this.Base64._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}
if(a!=64){t=t+String.fromCharCode(i)}}
t=this.Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}
return t},_utf8_decode:function(e){var t="",n=0,c1=0,c2=0,c3=0,r=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}
return t}},isInViewport:function(el,win){if(typeof el==='undefined'){return;}
var top=el.offsetTop,left=el.offsetLeft,width=el.offsetWidth,height=el.offsetHeight;while(el.offsetParent){el=el.offsetParent;top+=el.offsetTop;left+=el.offsetLeft;}
if(typeof win==='undefined'){return(top>=window.pageYOffset&&left>=window.pageXOffset&&(top+height)<=(window.pageYOffset+window.innerHeight)&&(left+width)<=(window.pageXOffset+window.innerWidth));}else{return(top>=win.scrollTop()&&left>=win.scrollLeft()&&(top+height)<=(win.scrollTop()+win.innerHeight())&&(left+width)<=(win.scrollLeft()+win.innerWidth()));}}});})(window.App);(function(App){'use strict';App.module("Updater",{initialize:function(moduleName,app,options){options.checkForUpdate();},checkForUpdate:function(){$.ajax({url:App.apiURL+'/updater.php'}).done(function(data){data=JSON.parse(data);var hasUpdate=false;for(var i=0,len=data.length;i<len;++i){if(typeof App.Updater[data[i].filename]==='undefined'){App.Updater[data[i].filename]=data[i].modifiedAt;}else{if(App.Updater[data[i].filename]!==data[i].modifiedAt){hasUpdate=true;}
App.Updater[data[i].filename]=data[i].modifiedAt;}}
if(hasUpdate){App.vent.trigger('update');}else{console.info('No Update Available');setTimeout(function(){App.Updater.options.checkForUpdate();},300*1000);}});}});})(window.App);(function(App){'use strict';App.module("Live",{initialize:function(moduleName,app,options){var key;for(key in options){if(key!=='initialize'){this[key]=options[key];}}},start:function(moduleName,app,options){var _this=this;if(App.Model.User.get('ip')!=='178.62.169.191'){var socket=io.connect('http://'+document.location.host+':8080/');socket.on('connect',function(){_this.connect({ip:App.Model.User.get('ip'),socket:socket});});socket.on('beingStreamed',function(data){var beingStreamed=data.beingStreamed;for(var i=0,len=beingStreamed.length;i<len;++i){_this.songStreaming(beingStreamed[i]);}});socket.on('addUser',function(data){_this.addUser(data);});socket.on('songStreaming',function(data){_this.songStreaming(data);});socket.on('streamEnded',function(data){_this.streamEnded(data.songId);});}},connect:function(data){App.socket=data.socket;App.socket.emit('newUser',data.ip);},addUser:function(data){App.usersOnline=data.online;App.viewport.currentView.ui.userCount.html(App.usersOnline);console.log('New User connected: '+data.ip);},songStreaming:function(data){if(data.songId!==App.Player.currentSongId){var checkStreams=_.find(App.songsStreaming,function(record){return record.songId===data.songId;});if(typeof checkStreams==='undefined'){console.log('new song streaming: '+data.songTitle+' total: '+data.totalPlaying);App.songsStreaming.push(data);var template=_.template($('#songstream-tpl').html())(data);App.viewport.currentView.ui.songStream.append(template);var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(data.songTitle))+'.png',validateImage=$('.stream-wrapper[data-song-id="'+data.songId+'"]').find('img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/music_note_404.png');});validateImage.attr('src',image);if(App.songsStreaming.length===1){App.viewport.currentView.ui.songStream.find('#currently-streaming').show();$($('.stream-wrapper').get(0)).css('margin-top','5px');}
$('.stream-wrapper:hidden').animo({animation:'bounceInUp',duration:1},function(){}).show();}}},localStreamEnded:function(songId){App.socket.emit('streamEnded',songId);},streamEnded:function(songId){if(songId!==App.Player.currentSongId){var record=_.findWhere(App.songsStreaming,{songId:songId});if(typeof record!=='undefined'){var index=App.songsStreaming.indexOf(record);App.songsStreaming.splice(index,1);$($('.stream-wrapper').get(App.songsStreaming.length-1)).animo({animation:'lightSpeedOut',duration:1},function(){$('.stream-wrapper[data-song-id="'+songId+'"]').remove();if(App.songsStreaming.length===0){App.viewport.currentView.ui.songStream.find('#currently-streaming').hide();}});}}}});})(window.App);(function(App){'use strict';var music=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
$(document).ready(function(){App.vent.trigger('loading:start');$.ajax({url:App.apiURL+'/music/1',beforeSend:function(xhr){$('label[for="toggle-music"]').click();}}).done(function(data){App.Page.Music=JSON.parse(data);App.vent.trigger('loading:end');App.Router.setPageTitle('Explore Music');App.Router.setPageHeader('Explore Music');App.Router.setPageSubTitle('Featured Artists');App.vent.trigger('hidePlayAll');App.vent.trigger('show:content',new App.View.Music());});});}});App.Controller.Music=music;})(window.App);(function(App){'use strict';var account=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
var mAlert=Messi.alert('<span id="msg">We are currently rebuilding this page, check back later.</span>');$('.messi').addClass('messi-open');$('.messi-content').css({height:'100px','text-align':'center'});$('.messi-content').find('#msg').css({'margin-top':'38px',display:'inline-block'});mAlert.resize();},doStuff:function(){this.trigger("stuff:done",this.stuff);}});App.Controller.Account=account;})(window.App);(function(App){'use strict';var discover=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
App.Router.currentController=this;}});App.Controller.Discover=discover;})(window.App);(function(App){'use strict';var player=Marionette.Controller.extend({ui:{playButton:'#play_button',shuffleButton:'#shuffle_button',playlistButton:'#playlist_button',playlist:'#current_playlist'},events:{'click @ui.playButton':'togglePlay','click #next_button':'playNext','click #prev_button':'playPrev','click @ui.shuffleButton':'toggleShuffle','click @ui.playlistButton':'togglePlaylist','click #download_button':'downloadPlaying'},initialize:function(options){if(typeof options.view!=='undefined'){var key;for(key in this){if(typeof options.view[key]==='undefined'){options.view[key]=this[key];}}}
App.vent.on('radio',_.bind(this.radio,this));App.vent.on('initialize:player',_.bind(this.initializePlayer,this));var me=this;App.Util.waitTillReady('#volume_thumb',function(){App.Volume={};App.Volume.thumb='#volume_thumb';App.Volume.width=$('#volume_back').width();App.Volume.left=$('#volume_back').offset().left+6;App.Volume.right=App.Volume.left+App.Volume.width;App.Volume.speaker='#volume_speaker';App.Volume.volume='1';App.Volume.set=function(left){$(App.Volume.thumb).css('left',left);if(left<=0){$(App.Volume.speaker).removeClass('volume_on');$(App.Volume.speaker).addClass('volume_off');}else{$(App.Volume.speaker).removeClass('volume_off');$(App.Volume.speaker).addClass('volume_on');}};$('#volume_thumb').on('mousedown',function(e){$(App.Volume.thumb).addClass('volume_thumb_active');$(document).on('mousemove',function(e){me.volume.mousemove(e);});$(document).on('mouseup',function(e){me.volume.mouseup(e);});});$('#volume_back').on('click',function(e){me.volume.mousemove(e);});if($.cookie('HXCVolume')){var volume=JSON.parse($.cookie('HXCVolume'));if(typeof App.Player.setVolume!=='undefined'){App.Player.setVolume(volume.num);}
App.Volume.volume=volume.num;App.Volume.set(volume.ui);}});App.playListOpen=false;App.Player.isPaused=true;App.Player.isPlaying=false;App.Player.Radio=this.radio;App.Player.shuffle=false;App.Player.currentPlaylist=typeof $.cookie('currentPlaylist')!=='undefined'?Number($.cookie('currentPlaylist')):0;App.resultsType='music';},downloadPlaying:function(e){if(typeof $(e.target).data('song-id')!=='undefined'){App.Dialog.Download.apply(this,arguments);}},togglePlaylist:function(){var css={},playlist=$('#current_playlist'),moveTo=$('#current_playlist div').outerHeight()+$('#bottom').outerHeight();css[App.browserPrefix.css+'transition']=App.browserPrefix.css+'transform 1s cubic-bezier(.25,.88,.62,1)';if(!App.playListOpen){css[App.browserPrefix.css+'transform']='translate3d(0, -'+moveTo+'px, 0)';}else{css[App.browserPrefix.css+'transform']='translate3d(0, 0, 0)';}
playlist.css(css).afterTransition(function(){if(!App.playListOpen){App.playListOpen=true;}else{App.playListOpen=false;}});},toggleShuffle:function(e){e.preventDefault();if(this.ui.shuffleButton.hasClass('selected')){this.ui.shuffleButton.removeClass('selected');App.Player.shuffle=false;}else{this.ui.shuffleButton.addClass('selected');App.Player.shuffle=true;}},togglePlay:function(){if($('#audio-element').length>0){if(this.ui.playButton.hasClass('paused')){this.ui.playButton.removeClass('paused');if(App.Player.isPlaying){App.Player.pause();}
App.Player.isPaused=true;}else{this.ui.playButton.addClass('paused');if(!App.Player.isPlaying){App.Player.play();}
App.Player.isPaused=false;}}},volume:{mousemove:function(e){var x=e.clientX;if(x<App.Volume.left-3){x=App.Volume.left-3;}
if(x>App.Volume.right-10){x=App.Volume.right-10;}
var volLeft=x-App.Volume.left;App.Volume.set(volLeft);App.Volume.volume=volLeft /(App.Volume.width-10);if(typeof App.Player.volume!=='undefined'){App.Player.setVolume(App.Volume.volume<0?0:App.Volume.volume);}
$.cookie('HXCVolume',JSON.stringify({num:(App.Volume.volume<0?0:App.Volume.volume),ui:volLeft}),{expires:30,path:'/'});if(App.Volume.volume<0){App.Volume.volume=0;}
if(App.Volume.volume>1){App.Volume.volume=1;}},mouseup:function(e){$(document).unbind('mousemove');$(document).unbind('mouseup');}},radio:function(e){var me=this;if(typeof e!=='undefined'){e.preventDefault();}
App.vent.trigger('message','Please Wait','Finding a good song to play for you...');$.ajax({type:"GET",url:App.baseURL+"/api/radio.php"}).done(function(data){var songId=data.track_id,songTitle=data.track_title;App.vent.trigger('message','Now Playing',songTitle,{position:'left'});$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.Controller.Player.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.isRadio=true;App.Player.play();$('#player-download-button').hide();});},playNext:function(){var me=this;if(typeof App.Player.currentSongId!=='undefined'&&App.Player.currentSongId!==null){App.vent.trigger('localStreamEnded',App.Player.currentSongId);}
if(!App.Player.isRadio&&App.Player.isPlaying){App.Player.pause();if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);}else{songIndex=-1;}
var plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex+1);if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('songId'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.vent.trigger('initialize:player');$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();$('#player-download-button').show();$('#player-download-button div, #player-download-button').data('song-id',songId);$('#player-download-button div, #player-download-button').data('song-title',songTitle);$('#player-download-button div, #player-download-button').data('playtime',App.Model.Queue.models[plus].get('bitrate'));}else{App.vent.trigger('message','','This is the last song!');}}else if(App.Player.isRadio){App.Player.Radio();}},playPrev:function(){var me=this;if(typeof App.Player.currentSongId!=='undefined'&&App.Player.currentSongId!==null){App.vent.trigger('localStreamEnded',App.Player.currentSongId);}
if(!App.Player.isRadio&&App.Player.isPlaying){App.Player.pause();if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);}else{songIndex=1;}
var plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex-1);if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('songId'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.vent.trigger('initialize:player');$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();$('#player-download-button').show();$('#player-download-button div, #player-download-button').data('song-id',songId);$('#player-download-button div, #player-download-button').data('song-title',songTitle);$('#player-download-button div, #player-download-button').data('playtime',App.Model.Queue.models[plus].get('bitrate'));}else{App.vent.trigger('message','','This is the first song!');}}else if(App.Player.isRadio){App.Player.Radio();}},addToFavorites:function(e){if(App.User.isLoggedIn){var songId=$(e.target).data('song-id'),songRecord=App.Model.Music.findWhere({id:songId});var checkFavs=App.Model.Favorites.findWhere({songId:songId});if(typeof checkFavs!=='undefined'){App.vent.trigger('message','Error','Already added to favorites!');return;}
var favModel=new App.Model.Favorite();favModel.set({bitrate:songRecord.get('bitrate'),songId:songRecord.get('songId'),playtime:songRecord.get('playtime'),name:songRecord.get('name'),userId:App.User.userId,playlistId:App.Player.currentPlaylist});App.Model.Favorites.add(favModel);favModel.save().done(function(){$(e.target).addClass('on');App.vent.trigger('message','Added To Favorites',App.Util.capitalizeWords(songRecord.get('name')));});}else{App.vent.trigger('message','Error','You must be logged in to add to favorites.');}},addToQueue:function(e){var model;if(App.currentPage==='favorites'){model=App.Model.Favorites;}else{model=App.Model.Music;}
var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});var songModel=songRecord.clone();App.Model.Queue.add(songModel);App.vent.trigger('message','Added To Queue',App.Util.capitalizeWords(songRecord.get('name')));},removeFromFavorites:function(e){var model=App.Model.Favorites;var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});$('.tooltip').poshytip('hide');songRecord.destroy({url:App.apiURL+'/favorites/'+songRecord.id,success:function(model,response){App.vent.trigger('message','Removed From Favorites',App.Util.capitalizeWords(songRecord.get('name')));}});},removeFromQueue:function(){var model=App.Model.Queue;var songId=$(e.target).data('song-id'),songRecord=model.findWhere({songId:songId});App.Model.Queue.remove(songRecord);App.vent.trigger('message','Removed From Queue',App.Util.capitalizeWords(songRecord.get('name')));},showDownloadDialog:function(e){App.Dialog.Download.apply(this,arguments);},streamSong:function(e){e.preventDefault();if(typeof App.Player.currentSongId!=='undefined'&&App.Player.currentSongId!==null){App.vent.trigger('localStreamEnded',App.Player.currentSongId);}
App.Player.isRadio=false;var songId=$(e.target).data('song-id'),playtime=$(e.target).data('playtime'),songTitle=$(e.target).data('song-title');App.vent.trigger('message','Now Playing',songTitle,{position:'left'});$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.Controller.Player.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();$('#player-download-button').show();$('#player-download-button div, #player-download-button').data('song-id',songId);$('#player-download-button div, #player-download-button').data('song-title',songTitle);$('#player-download-button div, #player-download-button').data('playtime',playtime);},initializePlayer:function(){var me=this,currentProps=App.Player;App.Player=$('#audio-element').mediaelementplayer({startVolume:App.Volume.volume,success:function(mediaElement,domObject){mediaElement.addEventListener('volumechange',function(e){},false);mediaElement.addEventListener('canplay',function(e){App.socket.emit('streamStarted',{songTitle:App.Player.currentSongTitle,songId:App.Player.currentSongId});$('#current_playlist_rows').find('.playing').removeClass('playing');$('#current_playlist_rows').find('a[data-song-title="'+App.Player.currentSongTitle+'"]').parents('li').addClass('playing');},false);mediaElement.addEventListener('play',function(e){App.Player.isPlaying=true;App.Player.isPaused=false;$('#play_button').addClass('paused');},false);mediaElement.addEventListener('ended',function(e){App.Player.isPlaying=false;App.vent.trigger('localStreamEnded',App.Player.currentSongId);if(!App.Player.isRadio){if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex,plus;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex+1);}else{plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):0;}
if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('songId'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.Controller.Player.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();}}else{App.Player.Radio();}},false);mediaElement.addEventListener('pause',function(e){App.Player.isPlaying=false;App.Player.isPaused=true;$('#play_button').removeClass('paused');},false);mediaElement.addEventListener('error',function(){$.ajax({type:"GET",url:App.baseURL+'/api/getyoutubeurl.php?id='+App.Player.currentSongId,success:function(url){me.streamYoutubeSong(url);}});},false);}});App.Player=App.Player.get(0);App.Player.Radio=currentProps.Radio;App.Player.shuffle=currentProps.shuffle;App.Player.currentPlaylist=currentProps.currentPlaylist;},streamYoutubeSong:function(url){var me=this,currentProps=App.Player;url='https://www.youtube.com/watch?v='+url;var videoElement=''+'<video autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'">'+'<source type="video/youtube" src="'+url+'" />'+'</video>';$('#audio-span').html(videoElement);App.Player=$('#audio-element').mediaelementplayer({startVolume:App.Volume.volume,alwaysShowControls:true,videoVolume:'horizontal',features:['playpause','progress','volume'],success:function(mediaElement,domObject){$('.mejs-layers').css('display','none');$('.me-plugin').css('visibility','hidden');$('.mejs-controls').css({top:'0px','margin-left':'25px'});mediaElement.addEventListener('volumechange',function(e){},false);mediaElement.addEventListener('canplay',function(e){App.socket.emit('streamStarted',{songTitle:App.Player.currentSongTitle,songId:App.Player.currentSongId});$('#current_playlist_rows').find('.playing').removeClass('playing');$('#current_playlist_rows').find('a[data-song-title="'+App.Player.currentSongTitle+'"]').parents('li').addClass('playing');},false);mediaElement.addEventListener('ended',function(e){App.Player.isPlaying=false;App.vent.trigger('localStreamEnded',App.Player.currentSongId);if(!App.Player.isRadio){if(App.Model.Queue.models.length===0){return;}
var songModel=_.find(App.Model.Queue.models,function(model){return model.attributes.songId===App.Player.currentSongId;});var songIndex,plus;if(typeof songModel!=='undefined'){songIndex=App.Model.Queue.indexOf(songModel);plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):(songIndex+1);}else{plus=App.Player.shuffle?App.Util.getRandomInt(0,App.Model.Queue.models.length):0;}
if(typeof App.Model.Queue.models[plus]!=='undefined'){var songId=App.Model.Queue.models[plus].get('songId'),songTitle=App.Model.Queue.models[plus].get('name');$('.now-playing').show();$('#audio-span').html('<audio src="'+App.baseURL+'/fetch/'+songId+'.mp3" autoplay="autoplay" id="audio-element" width="100%" volume="'+App.Volume.volume+'"></audio>');App.Controller.Player.initializePlayer();$('.now-playing-artist').text(decodeURI(App.Util.capitalizeWords(songTitle))).show();$('#display_coverart').html('<img src="" width="40" height="40" class="display_coverart_glare">').show();var image=App.apiURL+'/albumcover/'+App.Util.seoFriendlyDashes(encodeURI(songTitle))+'.png',validateImage=$('#display_coverart img');validateImage.on('error',function(){validateImage.attr('src',App.baseURL+'/images/question-mark.png');});validateImage.attr('src',image);App.Player.currentSongId=songId;App.Player.currentSongTitle=songTitle;App.Player.play();}}else{App.Player.Radio();}},false);mediaElement.addEventListener('play',function(e){App.Player.isPlaying=true;App.Player.isPaused=false;$('#play_button').addClass('paused');},false);mediaElement.addEventListener('pause',function(e){App.Player.isPlaying=false;App.Player.isPaused=true;$('#play_button').removeClass('paused');},false);}});App.Player=App.Player.get(0);App.Player.Radio=currentProps.Radio;}});App.Controller.Player=player;})(window.App);(function(App){'use strict';var index=Marionette.Controller.extend({initialize:function(options){if(App.User.isLoggedIn){App.Router.navigate('/favorites',{trigger:true,replace:false});return;}
if(App.Router.currentController!==null){App.Router.currentController.destroy();}
App.Router.displayHomepage();$.ajax({url:App.baseURL+"/api/suggest.php",beforeSend:function(xhr){}}).done(function(data){App.Suggested=JSON.parse(data);App.vent.trigger('show:homepage');var showSearchBox=function(){setTimeout(function(){$('#homepage-title h1').animo({animation:'fadeInUp',duration:0.4,keep:false},function(){$('#homepage-searchbox').animo({animation:'fadeInUp',duration:0.4,keep:false}).css('visibility','visible');}).css('visibility','visible');},1000);};if(App.isReady){showSearchBox();}else{App.vent.on('onReady',function(){showSearchBox();});}
var options={minMargin:0,maxMargin:0,itemSelector:'.homepage-tiles'};$('#homepage').rowGrid(options);});},doStuff:function(){this.trigger("stuff:done",this.stuff);}});App.Controller.Index=index;})(window.App);(function(App){'use strict';var routes=Marionette.Controller.extend({initialize:function(options){},videoResults:function(search){var exec=function(){App.resultsType='videos';$('label[for="toggle-videos"]').click();App.Router.startSearch(search);};if(App.isReady){exec();}else{App.vent.on('onReady',function(){exec();});}},musicResults:function(search){var exec=function(){App.resultsType='music';$('label[for="toggle-music"]').click();App.Router.startSearch(search);};if(App.isReady){exec();}else{App.vent.on('onReady',function(){exec();});}},music:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Music();});},videos:function(){this.videoResults('music');},account:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Account();});},forums:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Forums();});},events:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Events();});},video:function(videoId,title){App.Util.afterPageRender(function(){App.vent.trigger('page:video',videoId,title);});},upgrade:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Upgrade();});},favorites:function(){App.Util.afterPageRender(function(){App.vent.trigger('show:content',new App.View.Favorites({collection:App.Model.Favorites}));});},index:function(){App.Util.afterPageRender(function(){App.Router.currentController=new App.Controller.Index();});},discover:function(){App.vent.trigger('loading:start');App.Util.afterPageRender(function(){$(document).ready(function(){$.ajax({url:App.baseURL+"/api/suggest.php",beforeSend:function(xhr){}}).done(function(data){App.Suggested=JSON.parse(data);App.vent.trigger('loading:end');App.vent.trigger('hidePlayAll');App.Router.setPageTitle('Discover');App.Router.setPageHeader('Discover');App.Router.setPageSubTitle('Personalized Music Suggestions');App.vent.trigger('show:content',new App.View.Discover());});});});}});App.Controller.Routes=routes;})(window.App);(function(App){'use strict';var forums=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
var mAlert=Messi.alert('<span id="msg">We are currently rebuilding the forms, check back later.</span>');$('.messi').addClass('messi-open');$('.messi-content').css({height:'100px','text-align':'center'});$('.messi-content').find('#msg').css({'margin-top':'38px',display:'inline-block'});mAlert.resize();},doStuff:function(){this.trigger("stuff:done",this.stuff);}});App.Controller.Forums=forums;})(window.App);(function(App){'use strict';var favorites=Marionette.Controller.extend({ui:{},events:{'click .song_action_queue':'addToQueue','click .song_action_remove':'removeFromFavorites','click .download-button':'showDownloadDialog','click .play-song':'streamSong'},initialize:function(options){if(typeof options.view!=='undefined'){var key;for(key in this){if(typeof options.view[key]==='undefined'){options.view[key]=this[key];}}}
if(App.Router.currentController!==null){App.Router.currentController.destroy();}
if(App.isReady){App.vent.trigger('loading:end');App.vent.trigger('showPlayAll');App.vent.trigger('setPageTitle','My Favorites');App.vent.trigger('setPageHeader','My Favorites');App.vent.trigger('setPageSubTitle','');App.vent.trigger('initialize:tooltip');}else{}
App.Router.currentController=this;},addToQueue:function(e){App.Controller.Player.addToQueue.apply(this,arguments);},removeFromFavorites:function(e){App.Controller.Player.removeFromFavorites.apply(this,arguments);},removeFromQueue:function(e){App.Controller.Player.removeFromQueue.apply(this,arguments);},showDownloadDialog:function(e){App.Dialog.Download.apply(this,arguments);},streamSong:function(e){App.Controller.Player.streamSong.apply(this,arguments);},onRender:function(){},onShow:function(){App.vent.trigger('initialize:tooltip');},onClose:function(){}});App.Controller.Favorites=favorites;})(window.App);(function(App){'use strict';var events=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
App.vent.trigger('loading:end');App.vent.trigger('setPageTitle','Events');App.vent.trigger('setPageHeader','Events');App.vent.trigger('setPageSubTitle','Artist playing near you');App.vent.trigger('hidePlayAll');App.vent.trigger('show:content',new App.View.Events({collection:App.Model.Events}));}});App.Controller.Events=events;})(window.App);(function(App){'use strict';var upgrade=Marionette.Controller.extend({initialize:function(options){if(App.Router.currentController!==null){App.Router.currentController.destroy();}
$(document).ready(function(){App.vent.trigger('loading:end');App.vent.trigger('hidePlayAll');App.vent.trigger('setPageTitle','Premium Access');App.vent.trigger('setPageHeader','Premium Access');App.vent.trigger('setPageSubTitle','Unlimited Daily Downloads, For Life.');App.vent.trigger('show:content',new App.View.Upgrade());});}});App.Controller.Upgrade=upgrade;})(window.App);(function(App){'use strict';var music=Backbone.Collection.extend({url:function(){var params=App.Search.options.getParams();return App.apiURL+'/search.php?search='+params.search+'&page='+params.page;},initialize:function(){this.on('add',function(model){});}});App.Models.Music=music;App.Model.Music=new music();})(window.App);(function(App){'use strict';var user=Backbone.Model.extend({urlRoot:App.apiURL+'/users',url:function(options){return App.apiURL+'/users/'+App.User.id;},schema:{id:{type:'number'},downloadLimit:{type:'number'},userLevel:{type:'number'},isLoggedIn:{type:'boolean'},dailyDownloads:{type:'number'},totalDownloads:{type:'number'}},defaults:window.preloadData,idAttribute:'id',orignalFetch:Backbone.Collection.prototype.fetch,fetchTesting:function(options){var me=this;if(options.local){this.localStorage=App.localStore;this.orignalFetch();}else{this.localStorage=null;this.orignalFetch({success:function(){me.localStorage=App.localStore;}});}},setupSchema:function(){var schema=new Backbone.Schema(this);var key;for(key in this.schema){schema.define(key,{type:this.schema[key].type});}},initialize:function(){delete window.preloadData;this.setupSchema();var me=this;this.bind('change',this.setShortcuts);App.User=this.defaults;App.vent.on('onReady',function(){if(App.User.isLoggedIn){App.vent.trigger('ui:loggedin');}else{var location=document.location.href;if(location.indexOf('favorites')>-1||location.indexOf('upgrade')>-1){setTimeout(function(){App.Router.navigate('/',{trigger:true,replace:true});},500);}}});},toJSON:function(){var key,results={},hasKey;for(key in this.attributes){hasKey=_.has(this.changed,key);if(hasKey){results[key]=this.get(key);}}
delete results.favorites;return results;},setShortcuts:function(){var key,model;if(typeof App.Model.User.attributes[0]==='object'){App.Model.User.attributes=App.Model.User.attributes[0];}
model=App.Model.User.attributes;for(key in model){if(key==='dailyDownloads'||key==='userLevel'||key==='totalDownloads'||key==='id'){model[key]=typeof model[key]==='string'?Number(model[key]):model[key];}
if(key==='password'){App.Model.User.unset('password',{silent:true});}
if(key==='lastDownloaded'&&App.User.userLevel<5){if(Number(model[key])>moment(moment().add('hours',24)._d).unix()){model.dailyDownloads=0;}}}
if(model.userLevel>0){model.isLoggedIn=true;}
App.User=model;},});App.Models.User=user;App.Model.User=new user();})(window.App);(function(App){'use strict';var queue=Backbone.Collection.extend({localStorage:new Backbone.LocalStorage('HXCQueue'),initialize:function(){var _this=this;this.fetch().done(function(){_this.on('add',function(model){model.save();});_this.on('remove',function(model){_this.sync('delete',model);});});}});App.Models.Queue=queue;App.Model.Queue=new queue();})(window.App);(function(App){'use strict';var Main=Backbone.Model.extend({events:{'change:main':'build',},idAttribute:'main',initialize:function(){this.build();},build:function(){}});App.Model.Main=Main;})(window.App);(function(App){'use strict';var event=Backbone.Model.extend({events:{},idAttribute:'id',initialize:function(){}});App.Models.Event=App.Model.Event=event;})(window.App);(function(App){'use strict';var mp3=Backbone.Model.extend({events:{'change:all':'playNext',},idAttribute:'id',initialize:function(){},playNext:function(){}});App.Models.MP3=mp3;App.Model.MP3=new mp3();})(window.App);(function(App){'use strict';var videos=Backbone.Collection.extend({url:function(){var params=App.Search.options.getParams();return App.baseURL+'/api/search-videos.php?search='+params.search+'&page='+params.page;}});App.Models.Videos=videos;App.Model.Videos=new videos();})(window.App);(function(App){'use strict';var playlists=Backbone.Collection.extend({urlRoot:App.apiURL+'/playlists',url:function(options){return App.apiURL+'/playlists/userId/'+App.User.userId;},schema:{id:{type:'number'},title:{type:'string'},userId:{type:'string'}},setupSchema:function(){var schema=new Backbone.Schema(this);var key;for(key in this.schema){schema.define(key,{type:this.schema[key].type});}},initialize:function(){for(var i=0,len=window.playlists.length;i<len;++i){this.add(window.playlists[i]);}}});App.Models.Playlists=playlists;App.Model.Playlists=new playlists();})(window.App);(function(App){'use strict';var favorites=Backbone.Collection.extend({url:function(params){return App.apiURL+'/favorites/userId/'+App.User.userId;},initialize:function(){var _this=this;if(typeof window.favorites!=='undefined'){var model;for(var i=0,len=window.favorites.length;i<len;++i){model=new App.Model.Favorite();for(var key in window.favorites[i]){model.set(key,window.favorites[i][key]);}
_this.add(model);}}else{this.fetch();}
App.Model.User.set('favorites',_.clone(this));}});App.Models.Favorites=App.Model.Favorites=favorites;})(window.App);(function(App){'use strict';var video=Backbone.Model.extend({events:{'change:all':'playNext',},idAttribute:'id',initialize:function(){},playNext:function(){}});App.Models.Video=video;App.Model.Video=new video();})(window.App);(function(App){'use strict';var events=Backbone.Collection.extend({getURL:function(options){return App.apiURL+'/events/'+options.zipCode+'/'+options.miles+'/'+options.page+'/'+App.Util.seoFriendlyDashes(options.country);}});App.Models.Events=events;App.Model.Events=new events();})(window.App);(function(App){'use strict';var favorite=Backbone.Model.extend({url:App.apiURL+'/favorites',events:{},initialize:function(){}});App.Models.Favorite=App.Model.Favorite=favorite;})(window.App);(function(App){'use strict';var music=Backbone.Marionette.ItemView.extend({template:'#music-tpl',className:'',ui:{loadingImg:'#loading-genres img'},events:{'change .genre_dropdown':'showGenre'},background:{url:App.baseURL+'/images/grey_bg5.jpg',options:{fade:1000,centeredX:false,centeredY:true},changeOnExit:App.baseURL+'/images/love.jpg'},initialize:function(){var _this=this;App.Util.afterPageRender(function(){$(App.Regions.contentWindow.el).on('scroll',function(){if(App.currentPage==='music'){var elementCount=Math.round($('.song_row').length / 3);var isInView=App.Util.isInViewport($('.song_row').get($('.song_row').length-elementCount),$(App.Regions.contentWindow.el));if(isInView&&App.Page.Music.length>10){_this.nextPage();}}});});},showGenre:function(){var me=this,genre=$('.genre_dropdown').val();$.ajax({url:App.apiURL+'/'+genre+'/music/'+App.resultsPage,beforeSend:function(xhr){me.ui.loadingImg.show();}}).done(function(data){App.Page.Music=JSON.parse(data);App.vent.trigger('setPageSubTitle',App.Util.capitalizeWords(genre)+' Artists');App.vent.trigger('hidePlayAll');me.render();$('.genre_dropdown').val(genre);});},_loadingNext:false,_maxPages:5,nextPage:function(){var _this=this,genre=$('.genre_dropdown').val(),model;if(!this._loadingNext&&this._maxPages>App.resultsPage){App.resultsPage=(App.resultsPage+1);_this._loadingNext=true;var url=function(){if(genre){return App.apiURL+'/'+genre+'/music/'+App.resultsPage;}else{return App.apiURL+'/music/'+App.resultsPage;}};$.ajax({url:url(),beforeSend:function(xhr){App.Regions.Content.$el.append('<span id="more-results"><center><img src="/loading-bars.svg"></center></span>');}}).done(function(data){$('#more-results').remove();data=JSON.parse(data);var prevCount=App.Page.Music.length;$.each(data,function(index,record){App.Page.Music.push(record);});var nextPage=_.template($('#music-tpl').html())({count:prevCount});App.Regions.Content.$el.append(nextPage);_this._loadingNext=false;});}},templateHelpers:{count:0},onBeforeDestroy:function(){App.resultsPage=1;},onRender:function(){if(typeof this.background!=='undefined'&&this.background.url){if(App.Background[App.Util.getFilename(this.background.url)]){App.setBackground(this.background.url,this.background.options);}}},onShow:function(){},onDestroy:function(){if(typeof this.background!=='undefined'&&this.background.changeOnExit){App.setBackground(this.background.changeOnExit,this.background.options);}}});App.View.Music=music;})(window.App);(function(App){'use strict';var queue=Backbone.Marionette.ItemView.extend({template:'#queue-tpl',collection:App.Model.Queue,ui:{clearButton:'#current_playlist_clear',closeButton:'#current_playlist_close',removeSong:'.close',playlistSelect:'#playlists select'},events:{'click @ui.clearButton':'clearQueue','click @ui.closeButton':'togglePlaylist','click @ui.removeSong':'removeSong','click [data-song-id]':'streamSong','change @ui.playlistSelect':'selectPlaylist'},collectionEvents:{'reset':'render','add':'render','remove':'render'},bindings:{},initialize:function(){},removeSong:function(e){e.preventDefault();var songId=$(e.target).siblings('a[data-song-id]').data('songId'),songModel=this.collection.findWhere({songId:songId});this.collection.remove(songModel);},togglePlaylist:function(){App.vent.trigger('toggle:playlist');},clearQueue:function(){var collection=this.collection;_.invoke(collection.models,function(){collection.sync('delete',this);});App.Model.Queue.reset();},streamSong:function(e){App.Controller.Player.streamSong.apply(this,arguments);},selectPlaylist:function(e){var me=$(e.target),_this=this,value=me.val();if(value==='new'){me.replaceWith('<input type="text" id="playlist-name"><a href="#" id="save-playlist">Save</a>');$('#save-playlist').one('click',function(){App.Model.Playlists.add({title:$('#playlist-name').val(),userId:App.User.userId}).save().done(function(model){App.Model.Playlists.fetch().done(function(){var currentPlaylist=App.Model.Playlists.get(0).id;$.cookie('currentPlaylist',currentPlaylist,{expires:7,path:'/'});App.Regions.Queue.currentView.render();});});});}},onShow:function(){}});App.View.Queue=queue;})(window.App);(function(App){'use strict';var homepage=Backbone.Marionette.ItemView.extend({template:'#homepage-tpl',ui:{},events:{},initialize:function(){this._destroy=this.destroy;this.destroy=this.destroyAnimation;App.vent.once('close:homepage',_.bind(this.destroy,this));},onBeforeDestroy:function(){$('#explore').css('visibility','visible');$('#homepage').hide();$('#explore_nav').css('visibility','visible');},onShow:function(){},_destory:null,destroyAnimation:function(){var _this=this;$('#homepage').animo({animation:'vanishOut',duration:0.4,keep:false},function(){$('#explore').css('visibility','visible');$('#homepage').hide();$('#explore_nav').css('visibility','visible');_this._destroy();});}});App.View.Homepage=homepage;})(window.App);(function(App){'use strict';var header=Backbone.Marionette.ItemView.extend({template:'#header-tpl',events:{},initialize:function(){}});App.View.Header=header;})(window.App);(function(App){'use strict';var discover=Backbone.Marionette.ItemView.extend({template:'#discover-tpl',ui:{},events:{},controller:function(){return new App.Controller.Discover({view:this});},background:{url:App.baseURL+'/images/graffiti.jpg',options:{fade:1000,centeredX:false,centeredY:true},changeOnExit:App.baseURL+'/images/love.jpg'},initialize:function(){this.controller=this.controller();},onRender:function(){if(typeof this.background!=='undefined'&&this.background.url){if(App.Background[App.Util.getFilename(this.background.url)]){App.setBackground(this.background.url,this.background.options);}}},onShow:function(){},onDestroy:function(){if(typeof this.background!=='undefined'&&this.background.changeOnExit){App.setBackground(this.background.changeOnExit,this.background.options);}}});App.View.Discover=discover;})(window.App);(function(App){'use strict';var Player=Backbone.Marionette.ItemView.extend({template:'#player-tpl',className:'player',controller:function(){return new App.Controller.Player({view:this});},initialize:function(){this.controller=App.Controller.Player=this.controller();App.vent.on('toggle:playlist',_.bind(this.togglePlaylist,this));}});App.View.Player=Player;})(window.App);(function(App){'use strict';var footer=Backbone.Marionette.ItemView.extend({template:'#footer-tpl',events:{},initialize:function(){}});App.View.Footer=footer;})(window.App);(function(App){'use strict';var results=Backbone.Marionette.ItemView.extend({template:'#results-tpl',ui:{downloadButton:'.download-button',downloadVideoButton:'.download-video-button'},events:{'click .download-button':'showDownloadDialog','click .download-video-button':'showDownloadVideoDialog','click .play-song':'streamSong','click .song_action_love':'addToFavorites','click .song_action_queue':'addToQueue','click .download-album':'downloadAlbum'},initialize:function(){App.vent.on('download',_.bind(this.showDownloadDialog,this));},downloadAlbum:function(e){App.Dialog.DownloadAlbum.apply(this,arguments);},onShow:function(){App.vent.trigger('initialize:tooltip');},onRender:function(){},onClose:function(){},addToQueue:function(e){App.Controller.Player.addToQueue.apply(this,arguments);},addToFavorites:function(e){App.Controller.Player.addToFavorites.apply(this,arguments);},showDownloadDialog:function(e){App.Dialog.Download.apply(this,arguments);},showDownloadVideoDialog:function(e){App.Dialog.VideoDownload.apply(this,arguments);},streamSong:function(e){App.Controller.Player.streamSong.apply(this,arguments);},templateHelpers:{count:0},onBeforeDestroy:function(){App.resultsPage=1;}});App.View.Results=results;})(window.App);(function(App){'use strict';var _this;var viewport=Backbone.Marionette.LayoutView.extend({template:'#viewport-tpl',id:'viewport',ui:{pageHeader:'.explore_header',loader:'#loader',signInLink:'#sign_in_link',playlistButton:'#playlist_button',playlist:'#current_playlist',closePlaylist:'#current_playlist_close',queue:'#current_playlist_rows',pageSubTitle:'.explore_description',playAllButton:'#explore_play_button_sotd',pageHeaderWrapper:'.explore_header_wrapper',headerNavMusic:'#explore_nav_music',headerNavVideos:'#explore_nav_videos',headerNavRadio:'#explore_nav_radio',headerNavEvents:'#explore_nav_events',headerNavForums:'#explore_nav_forums',headerNavDiscover:'#explore_nav_discover',userNav:'#user_nav',songStream:'#song-stream',userCount:'#user-count',topSeatchForm:'#top_search_form',homepageSearchForm:'#homepage_search_form',userNavRadioButton:'#left_row_radio',signUpLink:'#create_account_link',searchTypeToggle:'input[name="search-type"]',searchInput:'.search_query',signoutLink:'#sign_out_link',supportButton:'#left_row_support',accountLink:'#account_link',bottomAdWrapper:'#bottom_ad_wrapper'},regions:{Header:'#header',Content:'#explore_content_sotd',Player:'#bottom',Homepage:'#homepage',Queue:'#current_playlist',Footer:'#footer',UserNav:'#user_nav',contentWindow:'#right'},events:{'click @ui.signInLink':'showLoginDialog','submit @ui.topSeatchForm':'doSearch','submit @ui.homepageSearchForm':'doHomepageSearch','click @ui.playAllButton':'addAllToQueue','click @ui.userNavRadioButton':'startRadio','click @ui.headerNavRadio':'startRadio','click @ui.signUpLink':'signUp','change @ui.searchTypeToggle':'toggleType','click @ui.signoutLink':'logout','click @ui.supportButton':'showSupport','click @ui.accountLink':'showAccount'},initialize:function(){_this=this;App.vent.on('search:results',_.bind(this.showResults,this));App.vent.on('loading:start',_.bind(this.showLoading,this));App.vent.on('loading:end',_.bind(this.hideLoading,this));App.vent.on('login:dialog',_.bind(this.showLoginDialog,this));App.vent.on('page:video',_.bind(this.streamVideo,this));App.vent.on('update:queue',_.bind(this.updateQueue,this));App.vent.on('show:homepage',_.bind(this.showHomepage,this));App.vent.on('toggle:menu',_.bind(this.toggleNavMenu,this));App.vent.on('loading:error',_.bind(this.showError,this));App.vent.on('message',_.bind(this.showMessage,this));App.vent.on('ui:loggedin',_.bind(this.updateUILoggedIn,this));App.vent.on('update',_.bind(this.showUpdateMessage,this));App.vent.on('initialize:tooltip',_.bind(this.initializeToolTip,this));App.vent.on('setPageTitle',_.bind(this.setPageTitle,this));App.vent.on('setPageHeader',_.bind(this.setPageHeader,this));App.vent.on('setPageSubTitle',_.bind(this.setPageSubTitle,this));App.vent.on('showPlayAll',_.bind(this.showPlayAll,this));App.vent.on('hidePlayAll',_.bind(this.hidePlayAll,this));App.vent.on('show:downloadsLeft',_.bind(this.showDownloadsLeft,this));App.vent.on('show:content',_.bind(this.showContent,this));App.vent.on('update:image',_.bind(this.updateImage,this));App.vent.on('lockscreen',_.bind(this.lockscreen,this));$(document).on('load','#ad-frame',function(){console.log('making links in iframe');$('#ad-frame a').attr('target','_blank');});Messi.prototype.show=function(){if(this.visible){return;}
$('#modal-wrapper').show();if(this.options.modal&&this.modal!==null){this.modal.show();}
this.messi.appendTo('#modal-wrapper');if(this.options.center){this.options.viewport=this.viewport(jQuery('.messi-box',this.messi));}
var modal=this.messi,_this=this;modal.resize();modal.animo({animation:"magictime vanishIn",keep:false,duration:0.45},function(){modal.css({'z-index':_this.options.zIndex+jQuery('.messi').length,opacity:1}).show();modal.addClass('messi-open');$('#wrapper').animo({animation:"blur",keep:false,duration:0.45});}).show();this.visible=true;};Messi.prototype.hide=function(after){if(!this.visible){return;}
var _this=this;$('#wrapper').removeClass('blur');$('#modal-wrapper').hide();if(_this.options.modal&&_this.modal!==null){_this.modal.remove();}
_this.messi.css({display:'none'}).remove();_this.visible=false;if(after){after.call();}
if(_this.options.unload){_this.unload();}
return this;};App.Regions=this.getRegions();App.setBackground=this.setBackground;},startRadio:function(e){App.Controller.Player.radio.apply(this,arguments);},showAccount:function(e){},showSupport:function(e){e.preventDefault();UserVoice.push(['set',{mode:'contact',target:false,position:'automatic',height:'425px',width:'400px',accent_color:'#367dca',locale:'en',ticket_custom_fields:{'Username':App.Model.User.get('username'),'Email':App.Model.User.get('email')},contact_title:'Having any problems? We are here to help!',smartvote_title:'What should we do next?',contact_enabled:true,screenshot_enabled:true,smartvote_enabled:true,post_idea_enabled:true}]);UserVoice.showLightbox();},toggleType:function(e){if($(this.ui.searchTypeToggle.selector+':checked').val()==='music'){App.resultsType='music';this.ui.searchInput.val('Search for music...');}else{App.resultsType='videos';this.ui.searchInput.val('Search for videos...');}},showUpdateMessage:function(){this.showMessage('','New Update Available! Click here to reload.',{sticky:true,timeout:1000,link:document.location.href,onClick:function(){$(this).find('.jGrowl-message').text('Reloading page...');}});},streamVideo:function(videoId,title){title=title.replace('---','-');App.currentVideo=videoId;this.Content.show(new App.View.Video());this.setPageTitle(title);this.setPageHeader(title);this.setPageSubTitle('');this.hidePlayAll();App.Util.waitTillReady('#video_player',function(){$(this).mediaelementplayer({startVolume:0.9,alwaysShowControls:true,videoVolume:'horizontal',features:['playpause','progress','volume','fullscreen'],success:function(mediaElement,domObject){mediaElement.addEventListener('volumechange',function(e){},false);mediaElement.setVolume(0.9);},error:function(){App.vent.trigger('message','Error','Unable to play video.');}});});},lockscreen:function(action){if(action==='show'){$('.lockscreen-bg').html(_.template($('#lockscreen-tpl').html())()).fadeIn('slow');$('html').addClass('lockscreen');var startTime=function()
{var today=new Date();var h=today.getHours();var m=today.getMinutes();var s=today.getSeconds();m=checkTime(m);s=checkTime(s);var day_or_night=(h>11)?"PM":"AM";if(h>12){h-=12;}
$('#time').html(h+":"+m+":"+s+" "+day_or_night);setTimeout(function(){startTime();},500);};var checkTime=function(i)
{if(i<10)
{i="0"+i;}
return i;};jQuery.fn.center=function(){this.css("position","absolute");this.css("top",Math.max(0,(($(window).height()-$(this).outerHeight())/ 2)+
$(window).scrollTop())-30+"px");this.css("left",Math.max(0,(($(window).width()-$(this).outerWidth())/ 2)+
$(window).scrollLeft())+"px");return this;};startTime();$(".center").center();$(window).resize(function(){$(".center").center();});var login=function(e){e.preventDefault();if($('.lockscreen-credentials input').val()){var isEmail=false,params={};params.username=App.Model.User.get('username');params.password=$('.lockscreen-credentials input').val();$.ajax({type:"POST",url:App.apiURL+"/login.php",data:params}).done(function(data){data=JSON.parse(data);if(typeof data.userId!=='undefined'){App.vent.trigger('lockscreen','hide');}else{App.vent.trigger('message','Error','Login Details Incorrect');}});}else{App.vent.trigger('message','Error','Password cannot be blank!');}};$('.lockscreen-credentials input').on('focus blur',function(e){if(e.type==='focus'){$('.lockscreen-credentials input').on('keydown',function(e){if(e.keyCode===13){login(e);}});}else if(e.type==='blur'){$('.lockscreen-credentials input').unbind('keydown');}});$('#lockscreen-login').on('click',function(e){login(e);});}else{$('#lockscreen-login').unbind('click');$('.lockscreen-bg').fadeOut();}},showPlayAll:function(){this.ui.pageHeaderWrapper.css('padding-left','110px');this.ui.playAllButton.show();},hidePlayAll:function(){this.ui.pageHeaderWrapper.css('padding-left','20px');this.ui.playAllButton.hide();},showHomepage:function(){this.Homepage.show(new App.View.Homepage());},updateQueue:function(){this.Queue.show(new App.View.Queue());},addAllToQueue:function(){if(App.currentPage!=='searchVideos'){var collection=App.currentPage==='showFavorites'?App.Model.Favorites:App.Model.Music,actionText=App.currentPage==='showFavorites'?'favorites':'results';if(collection.models.length>0){var songModels=[];for(var i=0,len=collection.models.length;i<len;++i){songModels.push(collection.models[i].clone());}
App.Model.Queue.add(songModels);App.vent.trigger('update:queue');App.vent.trigger('message','HXC Message Center','All '+actionText+' added to queue.');if(!App.Player.isPlaying){$($('.play-song').get(0)).click();}}}},updateImage:function(){this.UserNav.show(new App.View.UserNav());},logout:function(e){e.preventDefault();$.removeCookie('HXCID');document.location.reload();},toggleNavMenu:function(page){var me=this;var menuItem=false;if(page.toLowerCase().indexOf('music')>-1){menuItem=me.ui.headerNavMusic;}else if(page.toLowerCase().indexOf('events')>-1){menuItem=me.ui.headerNavEvents;}else if(page.toLowerCase().indexOf('videos')>-1){menuItem=me.ui.headerNavVideos;}else if(page.toLowerCase().indexOf('forums')>-1){menuItem=me.ui.headerNavForums;}else if(page.toLowerCase().indexOf('discover')>-1){menuItem=me.ui.headerNavDiscover;}else{$('.explore_nav_item').each(function(){$(this).removeClass('active');});}
if(menuItem){menuItem.addClass('active');menuItem.siblings('.explore_nav_item').removeClass('active');}},displayAd:function(){if(App.currentPage!=='upgrade'){App.Ads.bottom();}},showContent:function(view){this.Content.show(view);this.displayAd();},showLoginDialog:function(e){App.Dialog.Login.apply(this,arguments);},updateUILoggedIn:function(){var me=this;var updateUI=function(){$.cookie('HXCID',App.User.id);App.Model.Favorites=new App.Model.Favorites();$('#top_right').html('<a href="'+App.baseURL+'/profile" id="account_link" class="account_link">My Account</a> <a href="#" id="sign_out_link" data-bypass="true" class="account_link">Logout</a>');me.UserNav.show(new App.View.UserNav());UserVoice.push(['identify',{email:App.Model.User.get('email'),account:{id:App.Model.User.get('userId'),username:App.Model.User.get('username'),plan:App.Model.User.get('username')===5?'Premium':'Free'}}]);App.Settings.startTimeoutTimer();};if(App.isReady){updateUI();}else{App.vent.on('onReady',function(){updateUI();});}},signUp:function(e){if(e){e.preventDefault();}
this.showSignUpDialog();},showSignUpDialog:function(error){App.Dialog.SignUp.apply(this,arguments);},showUpgradeDialog:function(){App.Dialog.Upgrade.apply(this,arguments);},displayHomepage:function(){$('#explore').css('visibility','hidden');$('#explore_nav').css('opacity','hidden');$('#homepage').show();},hideHomepage:function(){App.vent.trigger('close:homepage');},updateURL:function(url){Backbone.history.navigate(url);},showMessage:function(title,message,options){var sticky=false,timeout=3000,position='#playerrightmsg';if(typeof options!=='undefined'){if(typeof options.sticky!=='undefined'){sticky=options.sticky;}
if(typeof options.timeout!=='undefined'){timeout=options.timeout;}
if(typeof options.position!=='undefined'){position=options.position==='left'?'#playerleftmsg':'#playerrightmsg';}}
$(position).jGrowl(message,{header:title,sticky:sticky,life:timeout,afterOpen:function(){$(this).css('opacity',0.95);if(typeof options!=='undefined'&&typeof options.link!=='undefined'){$(this).css({cursor:'pointer'});$(this).on('click',function(){if(typeof options.onClick!=='undefined'){options.onClick.apply(this,arguments);}
if(options.link.indexOf('http')>-1){document.location.href=options.link;}else{App.Router.navigate(options.link,{trigger:true,replace:false});}});}},openDuration:200,closeDuration:200,open:function(){var me=$(this);me.animo({animation:'vanishIn',duration:0.3,keep:false});},beforeClose:function(){var me=$(this);me.animo({animation:'vanishOut',duration:0.3,keep:false},function(){me.hide();});},beforeOpen:function(){var me=$(this);if(title===''){$(this).find('.jGrowl-message').css('margin-top','11px');}},closeTemplate:''});},showDownloadsLeft:function(){var downloadsLeft=App.Model.User.get('downloadLimit')-App.Model.User.get('dailyDownloads');if(downloadsLeft>0){if(downloadsLeft===1){App.vent.trigger('message','',downloadsLeft+' download left for today');}else{App.vent.trigger('message','',downloadsLeft+' downloads left for today');}}else{var warningImage='<img src="'+App.baseURL+'/images/download-warning.png" class="download-warning">';App.vent.trigger('message','',warningImage+'No more downloads left for today',{sticky:true,link:'/upgrade',onClick:function(){$(this).fadeOut('normal',function(){$(this).remove();});}});}},showError:function(){App.vent.trigger('loading:end');this.setPageTitle('Loading Error');this.setPageHeader('Loading Error');this.setPageSubTitle('');this.hidePlayAll();App.vent.trigger('message','Error','Unable to load page...');$('#explore_content_sotd').html('<div class="error-wrapper"><div class="error-message">Oops... Looks like we are having some trouble.</div><br>We have been notified of the problem. Please wait a few minutes and try again.</div>');},scrollToTop:function(){$('#right').animate({scrollTop:0}).promise().then(function(){});},showLoading:function(title){if(!title){title='Loading...';}
App.isLoading=true;this.scrollToTop();App.loadingCountDown=setTimeout(function(){if($('#spinner').is(':visible')){App.vent.trigger('loading:error');$(document.body).css({cursor:'auto'});$('#spinner').fadeOut();}},15000);$(document.body).css({cursor:'progress'});this.setPageTitle(App.Util.capitalizeWords(title));this.setPageHeader('Loading...');this.setPageSubTitle('Fetching content...');$('#spinner').fadeIn();$('#middle').addClass('blur');},hideLoading:function(){App.isLoading=false;$(document.body).css({cursor:'auto'});clearTimeout(App.loadingCountDown);App.loadingCountDown=false;$('#spinner').fadeOut();$('#middle').removeClass('blur');},setBackground:function(url,options){if(typeof options==='undefined'||typeof options!=='object'){options={fade:1000,centeredX:false,centeredY:true};}
url=App.baseURL+'/imagecache/image.php?src='+url.replace(App.baseURL,'')+'&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';$('#middle').backstretch(url,options);},doSearch:function(event){event.preventDefault();App.resultsPage=1;this.hideHomepage();App.vent.trigger('search');},doHomepageSearch:function(event){event.preventDefault();App.resultsPage=1;this.hideHomepage();var search=$('#homepage_search_input').val();$('#top_search_input').val(search);App.vent.trigger('search');},onShow:function(){this.Header.show(new App.View.Header());this.Footer.show(new App.View.Footer());this.Player.show(new App.View.Player());this.Queue.show(new App.View.Queue());this.fixUiElements();App.vent.trigger('initialize:tooltip');},fixUiElements:function(){for(var key in this.ui){if(this.ui[key].length===0){this.ui[key]=$(this.ui[key].selector);}}},setPageHeader:function(title){this.ui.pageHeader.text(title);},setPageSubTitle:function(title){this.ui.pageSubTitle.text(title);},setPageTitle:function(title){$('title').html(App.Util.capitalizeWords(title)+' at '+App.websiteTitle+'&trade;');},initializeToolTip:function(){$('.tooltip').poshytip({className:'tip-twitter',liveEvents:true,showTimeout:1,alignTo:'target',alignX:'center',offsetY:5,allowTipHover:false,fade:false,slide:false});},showResults:function(){App.vent.trigger('loading:end');var searchParams=App.Search.options.getParams(),searchTerms=searchParams.search,pageTitle;if(App.currentPage!=='videos'){App.currentPage=App.resultsType==='music'?'searchMusic':'searchVideos';}
this.toggleNavMenu(App.currentPage);if(App.resultsType!=='videos'){this.showPlayAll();pageTitle=App.Util.capitalizeWords(searchTerms)+' '+App.Util.capitalizeWords(App.resultsType)+' Downloads';}else{this.hidePlayAll();pageTitle=App.Util.capitalizeWords(searchTerms)+' Video Downloads';}
if(App.currentPage==='videos'){this.updateURL('/videos');}else{this.updateURL(App.resultsType+'/'+App.Util.seoFriendlyDashes(searchTerms));}
this.setPageTitle(pageTitle);this.setPageHeader('Search Results');this.setPageSubTitle(pageTitle);this.Content.show(new App.View.Results());var validateImages=$(".song_row_cover_art .validateImg");validateImages.on('error',function(){$(this).parents('.song_row_cover_art').css({'background':'url('+App.baseURL+'/images/question-mark.png)','background-size':'114px 114px','background-position-x':'-19px','background-position-y':'-9px'}).children('.validateImg').remove();});$.each(validateImages,function(){$(this).attr('src',$(this).data('validate-url'));});this.displayAd();}});App.View.Viewport=viewport;})(window.App);(function(App){'use strict';var favorites=Backbone.Marionette.ItemView.extend({template:'#favorites-tpl',controller:function(){return new App.Controller.Favorites({view:this});},collectionEvents:{'sync':'render','remove':'render'},background:{url:App.baseURL+'/images/love.jpg',options:{fade:1000,centeredX:false,centeredY:true},changeOnExit:false},initialize:function(){this.controller=this.controller();},onRender:function(){if(typeof this.background!=='undefined'&&this.background.url){if(App.Background[App.Util.getFilename(this.background.url)]){App.setBackground(this.background.url,this.background.options);}}
var validateImages=$(".song_row_cover_art .validateImg");validateImages.on('error',function(){$(this).parents('.song_row_cover_art').css({'background':'url('+App.baseURL+'/images/question-mark.png)','background-size':'114px 114px','background-position-x':'-19px','background-position-y':'-9px'}).children('.validateImg').remove();});$.each(validateImages,function(){$(this).attr('src',$(this).data('validate-url'));});},onDestroy:function(){}});App.View.Favorites=favorites;})(window.App);(function(App){'use strict';var albums=Backbone.Marionette.ItemView.extend({template:'#albums-tpl',ui:{},events:{},initialize:function(){},onShow:function(){},onClose:function(){}});App.View.Albums=albums;})(window.App);(function(App){'use strict';var video=Backbone.Marionette.ItemView.extend({template:'#video-tpl',ui:{},events:{},initialize:function(){},onShow:function(){},onClose:function(){}});App.View.Video=video;})(window.App);(function(App){'use strict';var userNav=Backbone.Marionette.ItemView.extend({template:'#userNav-tpl',ui:{uploadImageLink:'.upload-image'},events:{'click @ui.uploadImageLink':'uploadImage'},onShow:function(){var _this=this;_this.$el.css('visibility','hidden');_this.$el.find('img').one('error',function(){_this.$el.css('visibility','visible');var showUserNav=function(){_this.$el.find('img').attr('src',App.baseURL+'/images/noimage.jpg');_this.$el.animo({animation:'vanishIn',duration:0.5,keep:false});};showUserNav();});_this.$el.find('img').one('load',function(){_this.$el.css('visibility','visible');var showUserNav=function(){_this.$el.animo({animation:'vanishIn',duration:0.5,keep:false});};showUserNav();}).each(function(){if(this.complete){$(this).load();}});},onClose:function(){},uploadImage:function(e){if(e){e.preventDefault();}
if(typeof App.Modal.Uploader!=='undefined'){App.Modal.Uploader.show();App.Modal.Uploader.messi.addClass('messi-open');return;}
var me=this;App.Modal.Uploader=new Messi(_.template($('#uploader-tpl').html()),{modal:true,show:false,title:'Upload Image',buttons:[{id:0,label:'Cancel',val:'cancel',class:'cancel-button'},{id:1,label:'Upload',val:'upload',class:'upload-button'}]});App.Dialog.showModal(App.Modal.Uploader);App.Modal.Uploader.messi.find('.btnbox').unbind('click');$(document).on('click','.upload-button',function(e){var formData=new FormData($('.uploader-wrapper')[0]);$.ajax({url:App.baseURL+'/api/uploader.php',type:'POST',xhr:function(){var myXhr=$.ajaxSettings.xhr();if(myXhr.upload){}
return myXhr;},data:formData,cache:false,contentType:false,processData:false}).done(function(data){data=JSON.parse(data);App.Modal.Uploader.hide();if(typeof data.success!=='undefined'){App.Model.User.save({image:data.url});me.updateImage();App.vent.trigger('message','HXC Message Center','Image uploaded successfully!');}else{App.vent.trigger('message','Error','Image upload error');}});});$(document).on('click','.cancel-button',function(e){App.Dialog.hideModal(App.Modal.Uploader);});}});App.View.UserNav=userNav;})(window.App);(function(App){'use strict';var events=Backbone.Marionette.ItemView.extend({template:'#events-tpl',ui:{zipCode:'#zip_code',country:'#country',miles:'#miles',eventsButton:'#find-events'},collectionEvents:{'sync':'render'},events:{'click @ui.eventsButton':'findEvents'},initialize:function(){},findEvents:function(e){e.preventDefault();var _this=this;if(this.ui.zipCode.val()===null||this.ui.zipCode.val()===''){App.vent.trigger('message','Error','Please enter zipcode to search for events');return;}
var options={country:this.ui.country.val(),zipCode:this.ui.zipCode.val(),miles:this.ui.miles.val(),page:1};var url=this.collection.getURL(options),buttonText=this.ui.eventsButton.html(),currentWidth=this.ui.eventsButton.width(),currentHeight=this.ui.eventsButton.height();this.ui.eventsButton.css({'width':currentWidth+'px','height':currentHeight+'px'}).html('<center><img src="/loading-bars-white.svg" style="margin-top:-7px;height:32px;width:auto;"></center>');this.collection.fetch({url:url,update:true}).done(function(){});},onRender:function(){},onShow:function(){},onClose:function(){},_destory:null,destroyAnimation:function(){debugger;var _this=this;App.viewport.currentView.Content.$el.animo({animation:"magictime spaceOutLeft",keep:false,duration:1},function(){_this._destroy();App.viewport.currentView.Content.$el.animo({animation:"magictime spaceInRight",keep:false,duration:1},function(){}).show();}).show();}});App.View.Events=events;})(window.App);(function(App){'use strict';var upgrade=Backbone.Marionette.ItemView.extend({template:'#upgrade-tpl',ui:{},events:{},background:{url:App.baseURL+'/images/planet%20on%20the%20valley.jpg',options:{fade:1000,centeredX:false,centeredY:true},changeOnExit:App.baseURL+'/images/love.jpg'},initialize:function(){},onRender:function(){if(typeof this.background!=='undefined'&&this.background.url){if(App.Background[App.Util.getFilename(this.background.url)]){App.setBackground(this.background.url,this.background.options);}}},onShow:function(){var checkDefined=function(){if(typeof App.User!=='undefined'&&typeof App.User.username!=='undefined'){$('input[name="os0"]').val(App.User.username);}else{setTimeout(function(){checkDefined();},1000);}};checkDefined();},onDestroy:function(){if(typeof this.background!=='undefined'&&this.background.changeOnExit){App.setBackground(this.background.changeOnExit,this.background.options);}}});App.View.Upgrade=upgrade;})(window.App);(function(App){'use strict';var router=Backbone.Marionette.AppRouter.extend({controller:new App.Controller.Routes(),currentController:null,initialize:function(options){var me=this;this.initializeLinks();this.on('route',function(route,params){if(route!=='index'){App.Util.afterPageRender(function(){me.hideHomepage();});}
App.currentPage=route;App.Util.waitTillReady('#explore_nav',function(){App.vent.trigger('toggle:menu',route);$('#right').animate({scrollTop:0}).promise().then(function(){});});});},appRoutes:{'':'index','music':'music','music/:search':'musicResults','videos/:search':'videoResults','search/:search/:page/mp3':'musicResults','search/:search/:page/video':'videoResults','video/:videoId/:title':'video','favorites':'favorites','upgrade':'upgrade','events':'events','forums':'forums','account':'account','profile':'account','videos':'videos','discover':'discover','*path':'index'},displayHomepage:function(){var exec=function(){$('#explore').css('opacity','hidden');$('#explore_nav').css('visibility','hidden');$('#homepage').show();};if(App.isReady){exec();}else{App.vent.on('onReady',function(){exec();});}},hideHomepage:function(){var exec=function(){App.vent.trigger('close:homepage');};if(App.isReady){exec();}else{App.vent.on('onReady',function(){exec();});}},startSearch:function(search){$('#top_search_input').val(App.Util.removeDashes(search));App.vent.trigger('search',search);},setPageHeader:function(title){App.vent.trigger('setPageHeader',title);},setPageSubTitle:function(title){App.vent.trigger('setPageSubTitle',title);},setPageTitle:function(title){$('title').html(App.Util.capitalizeWords(title)+' at '+App.websiteTitle+'&trade;');},initializeLinks:function(){$(document).on("click","a:not([data-bypass])",function(evt){var href={prop:$(this).prop("href"),attr:$(this).attr("href")};var root=location.protocol+"//"+location.host+Backbone.history.options.root;if(href.prop&&href.prop.slice(0,root.length)===root){evt.preventDefault();var page=href.attr;if(App.Util.contains(page,App.baseURL)){page=page.replace(App.baseURL,'');}
Backbone.history.navigate(page,true);}});},onRoute:function(){}});App.Router=new router();Backbone.history.start({pushState:true,root:App.webRoot});})(window.App);(function(App){'use strict';$(document).on('ready',function(){App.start();App.isReady=true;App.vent.trigger('onReady');App.Background={};App.Background['love.jpg']=false;App.Background['planet%20on%20the%20valley.jpg']=false;App.Background['grey_bg5.jpg']=false;App.Background['graffiti.jpg']=false;var img=new Image(),imgTwo=new Image(),imgThree=new Image(),imgFour=new Image();img.onload=function(){var backgroundParam=App.Util.getURLParameter('background'),background=backgroundParam?App.baseURL+'/images/'+backgroundParam:App.baseURL+'/imagecache/image.php?src=/images/love.jpg&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';$('#middle').backstretch(background,{fade:1000,centeredX:false,centeredY:true});App.Background['love.jpg']=true;};imgTwo.onload=function(){App.Background['planet%20on%20the%20valley.jpg']=true;};imgThree.onload=function(){App.Background['grey_bg5.jpg']=true;};imgFour.onload=function(){App.Background['graffiti.jpg']=true;};img.src=App.baseURL+'/imagecache/image.php?src=/images/love.jpg&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';imgTwo.src=App.baseURL+'/imagecache/image.php?src=/images/planet%20on%20the%20valley.jpg&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';imgThree.src=App.baseURL+'/imagecache/image.php?src=/images/grey_bg5.jpg&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';imgFour.src=App.baseURL+'/imagecache/image.php?src=/images/graffiti.jpg&w='+$('#middle').width()+'&h='+$('#middle').height()+'&zc=1';});})(window.App);<!--Copyright © HXCMusic Media Network - Generated by HXC Cache System 2.0 at Wednesday 17th of September 2014 03:35:57 AM-->